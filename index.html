<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>反応時間測定アプリ</title>
    <style>
        body, html {
            height: 100%;
            margin: 0;
            overflow: hidden; /* スクロールを禁止 */
        }
        #touch-area {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            background-color: #3498db; /* 初期画面の色 (青) */
            color: white;
            font-size: 24px;
            font-family: sans-serif;
            text-align: center;
            transition: background-color 0.1s; /* 色の変化を滑らかに */
        }
        #touch-area.waiting {
            background-color: #f1c40f; /* 待機中の色 (黄) */
        }
        #touch-area.go {
            background-color: #2ecc71; /* スタートの色 (緑) */
        }
    </style>
</head>
<body>

<div id="touch-area">
    <p id="message">画面に触れ続けてください</p>
</div>

<script>
    const touchArea = document.getElementById('touch-area');
    const message = document.getElementById('message');

    let timerId;
    let startTime;
    let appState = 'initial'; // 'initial', 'waiting', 'go', 'result'

    // 画面に指が触れた時の処理
    touchArea.addEventListener('touchstart', (e) => {
        e.preventDefault(); // 画面のズームなどを防ぐ

        if (appState === 'initial' || appState === 'result') {
            appState = 'waiting';
            touchArea.classList.remove('go');
            touchArea.classList.add('waiting');
            message.textContent = '準備... 合図が出たら指を離して！';
            
            // 2〜5秒のランダムな待機時間後にスタート
            const randomDelay = Math.random() * 3000 + 2000;
            timerId = setTimeout(startMeasurement, randomDelay);
        }
    });

    // 画面から指が離れた時の処理
    touchArea.addEventListener('touchend', (e) => {
        e.preventDefault();

        if (appState === 'go') {
            const endTime = performance.now();
            const reactionTime = (endTime - startTime).toFixed(2); // 小数点以下2桁まで
            message.textContent = `反応時間: ${reactionTime} ms\nもう一度試すには画面をタッチ`;
            
            appState = 'result';
            touchArea.classList.remove('go');
            touchArea.style.backgroundColor = '#3498db'; // 初期の色に戻す

        } else if (appState === 'waiting') {
            // 早すぎた場合 (お手つき)
            clearTimeout(timerId); // 予約したスタートをキャンセル
            appState = 'result';
            message.textContent = '早すぎます！合図が出てから離してください。\nもう一度試すには画面をタッチ';
            touchArea.classList.remove('waiting');
        }
    });
    
    // 測定開始の処理
    function startMeasurement() {
        if (appState === 'waiting') {
            appState = 'go';
            touchArea.classList.remove('waiting');
            touchArea.classList.add('go');
            message.textContent = 'スタート！';
            startTime = performance.now();
        }
    }

</script>

</body>
</html>
